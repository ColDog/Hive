%ul.nav.nav-tabs{ role: 'tablist' }
  %li{ role: 'presentation', class: (params[:tab] == 'search' or params[:tab].nil? or params[:tab] == '') ? 'active' : '' }
    %a{ href: '#search', 'aria-controls' => 'search', role: 'tab', 'data-toggle' => 'tab' } View
  %li{ role: 'presentation', class: params[:tab] == 'add' ? 'active' : '' }
    %a{ href: '#add', 'aria-controls' => 'add', role: 'tab', 'data-toggle' => 'tab' } Add
  %li{ role: 'presentation', class: params[:tab] == 'load' ? 'active' : '' }
    %a{ href: '#load', 'aria-controls' => 'load', role: 'tab', 'data-toggle' => 'tab' } Upload/Download

%div.tab-content
  %div.tab-pane#search{ role: 'tabpanel', class: (params[:tab] == 'search' or params[:tab].nil? or params[:tab] == '') ? 'active' : '' }
    %br
    = render 'admin/supplies/search'
    %div
      %table.table
        %thead
          %tr
            %th Name
            %th Owner Type
            %th Owner Name
            %th Notes
            %th Add Owner
            %th
        - cache(SupplyList.cache_key(params)) do
          - @supply_lists.each do |list|
            - cache(list) do
              %tr
                %td
                  = list.name
                %td
                  = list.type
                %td
                  = list.owner.name if list.owner
                %td
                  = list.notes
                %td
                  = form_tag admin_supply_lists_add_owner_path(list), method: :post do
                    = select_tag :organization_id, '', {include_blank: 'Add Organization',  class: 'short-form form-control input-sm org-sel', style: 'width:120px;'}
                    = select_tag :user_id, '', {include_blank: 'Add User',  class: 'short-form form-control input-sm usr-sel', style: 'width:120px;'}
                    = submit_tag 'âˆš', class: 'btn btn-default btn-sm'
                %td
                  = link_to 'X', admin_supply_list_path(list), method: :delete, class: 'btn btn-default btn-sm'

  %div.tab-pane#add{ role: 'tabpanel', class: params[:tab] == 'add' ? 'active' : '' }
    %br
    = form_for :supply_list, url: admin_supply_lists_path, method: :post do |f|
      = f.text_field :name, placeholder: 'name', class: 'form-control short-form'
      = f.hidden_field :supply_id, value: variable.id
      = f.text_field :notes, placeholder: 'notes', class: 'form-control short-form'
      = f.submit 'Submit', class: 'btn btn-primary', data: { disable_with: 'processing...' }

  %div.tab-pane#load{ role: 'tabpanel', class: params[:tab] == 'load' ? 'active' : '' }
    %br
    %div
      %h4
        = link_to 'Download', admin_supply_lists_download_path(variable, format: :csv)
      %br
      %h4 Upload Csv
      = form_tag admin_supply_lists_upload_path(variable.id), method: :post, multipart: true, class: 'form-inline' do
        = file_field_tag :file
        %br
        = submit_tag 'Upload', class: 'btn btn-primary btn-sm'
    - if flash['results']
      %h4 Successful Updates (name of record)
      %ul
        - flash['results']['successes'].each do |success|
          %li
            = success
      %h4 Errors (name of record: error message)
      %ul
        - flash['results']['errors'].each do |name, error|
          %li
            = "#{name}: #{error}"

= render 'admin/supplies/js'